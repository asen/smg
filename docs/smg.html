<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Smule Grapher (SMG) - Concepts Overview</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 48em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Smule Grapher (SMG) - Concepts Overview</h1>
</header>
<p><a href="index.html">Back To Index</a></p>
<nav id="TOC" role="doc-toc">
<h2 id="toc-title">Table of Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#what-is-it">What is it</a></li>
</ul></li>
<li><a href="#install">Install</a></li>
<li><a href="#ui-orientation">UI orientation</a></li>
<li><a href="#concepts-overview">Concepts overview</a>
<ul>
<li><a href="#rrd-objects">RRD objects</a></li>
<li><a href="#intervals-runs-and-scheduler">Intervals, runs and scheduler</a></li>
<li><a href="#pre_fetch-and-run-command-trees">pre_fetch and run command trees</a></li>
<li><a href="#period-since-and-period-length">Period since and period length</a></li>
<li><a href="#filters">Filters</a>
<ul>
<li><a href="#remote-filter">Remote filter</a></li>
<li><a href="#text-regex-filter">Text Regex filter</a></li>
<li><a href="#prefix-filter">Prefix filter</a></li>
<li><a href="#suffix-filter">Suffix filter</a></li>
<li><a href="#regex-filter">Regex filter</a></li>
<li><a href="#regex-exclude-filter">Regex Exclude filter</a></li>
<li><a href="#parent-regex-filter">Parent Regex filter</a></li>
<li><a href="#labels-filter">Labels filter</a></li>
<li><a href="#index-filter">Index filter</a></li>
</ul></li>
<li><a href="#indexes">Indexes</a></li>
<li><a href="#custom-dashboards">Custom dashboards</a></li>
<li><a href="#graph-options">Graph options</a>
<ul>
<li><a href="#step">Step</a></li>
<li><a href="#maxy">MaxY</a></li>
<li><a href="#miny">MinY</a></li>
<li><a href="#rows-and-columns">Rows and columns</a></li>
<li><a href="#sorting-and-grouping">Sorting and grouping</a></li>
</ul></li>
<li><a href="#aggregate-functions">Aggregate functions</a></li>
<li><a href="#view-objects-and-calculated-graphs">View objects and calculated graphs</a></li>
<li><a href="#remotes">Remotes</a></li>
<li><a href="#plugins">Plugins</a>
<ul>
<li><a href="#currently-available-plugins">Currently available plugins</a></li>
</ul></li>
<li><a href="#monitoring">Monitoring</a>
<ul>
<li><a href="#anomaly-detection-via-the-mon-check-plugin">Anomaly detection (via the “mon” check plugin)</a></li>
</ul></li>
</ul></li>
<li><a href="#running-and-troubleshooting">Running and troubleshooting</a>
<ul>
<li><a href="#run-in-a-container">Run in a container</a></li>
<li><a href="#run-in-k8s">Run in k8s</a></li>
<li><a href="#classic-mode">Classic mode</a>
<ul>
<li><a href="#pre-requisites">Pre-requisites</a></li>
<li><a href="#installation-from-.tgz-bundle">Installation from .tgz bundle</a></li>
<li><a href="#installation-from-sources">Installation from sources</a></li>
<li><a href="#reverse-proxy">Reverse proxy</a></li>
</ul></li>
</ul></li>
<li><a href="#developer-documentation">Developer documentation</a>
<ul>
<li><a href="#development-setup">Development setup</a></li>
</ul></li>
</ul>
</nav>
<h2 id="introduction">Introduction</h2>
<h3 id="what-is-it">What is it</h3>
<p>Smule Grapher (SMG) is a Play 2.x/Scala app used to retrieve data from arbitrary monitored services (generally - using external/bash commands) and using <a href="https://oss.oetiker.ch/rrdtool/">rrdtool</a> to maintain many RRD databases with the retrieved data and then plot and display time-series graphs (and much more) from them.</p>
<p>(IMHO) These days there is a monitoring tools gap introduced by abandoining Nagios and its “checks” in favor of Prometheus and its “metrics”. SMG can fill that gap for you an can be used as a replacement of any (or both) of these in a lot of use cases.</p>
<p>Some Features:</p>
<ul>
<li>simple config suitable for being generated from a configuration management system, like Chef/Puppet etc. E.g</li>
</ul>
<pre>
    - some.var:
      command: /path/to/script_outputting_var_value.sh
      vars:
        - label: var1
</pre>
<ul>
<li>arbitrary number of vars per object/graph allowed (though defining more than 10 is rarely a good idea)</li>
<li>single instance/config can specify and work with different update periods - like evey minute (the default), every 5 minutes, every hour etc.</li>
<li>script_outputting_var_value.sh can be a mrtg-compatible helper script</li>
<li>Remote instances support. One can have multiple instances spread across different geo locations but use single UI access point for all.</li>
<li>Built-in advanaced monitoring on any graphed value</li>
<li>Aggregate functions allowing to see the sum/average/etc from arbitrary number of (compatible) values</li>
<li>Scala plugins support - it is possible to extend SMG by writing plugins for custom functionality including custom data input sources which do not necessarily fit the model where external command is executed on regular interval to fetch the values for updates. E.g. SMG comes with a JMX plugin which keeps persistent connections to the target Java JMX servers. It is also possible to create custom actions attached to graphs using plugins including e.g. visualizations. SMG comes with javascript-based “Zoom” functionality based on the open source plot.ly JS graphing library.</li>
<li>Support for OpenMetrics (Prometheus) /metrics end-points scrapping and graphs via the Scrape/Autoconf plugins. In addition it is now possible to monitor back-end services (like redis/mysql etc) natively using the Autoconf plugin - based on templates. This replaces the need to run Prometheus “exporters” and can use native clients to get stats from the monitored service. All this can be used with the Kube plugin and K8s annotations for a complete monitoring solution including alerts and graphs.</li>
</ul>
<p>See concepts overview below for more details. There is also now a (long) document explaining the <a href="History_and_Evolution.html">history and evolution of SMG</a> which covers these concepts in more detail and the use cases which they are intended to address.</p>
<h2 id="install">Install</h2>
<p>SMG can be installed and run from a Docker image, a pre-built .tgz or run directly from sources.</p>
<p>See the <a href="https://github.com/asen/smg/blob/master/README.md">README.md</a> in the source tree for most up to date install instructions</p>
<h2 id="ui-orientation">UI orientation</h2>
<p>SMG’s main page (/) displays a list of <a href="#concepts-indexes">configured top-level indexes</a> (this is where the <strong>Configured indexes</strong> menu item points to). These are links to filter result pages (/dash) with pre-set <a href="#concepts-filters">filters</a>. The later page is where one can also enter custom filters to customize the set of displayed objects (possibly - narrowing down the defined in the index filter). You can get an “empty” (match-all) filter by clicking the <strong>All Graphs</strong> link in the top menu. The <strong>Automatic index</strong> represents a tree structure which SMG will automatically create from all object ids. That looks much better if the object ids follow a hierarchical structure where “levels” are seprated by dots. The <strong>Search</strong> menu item allows searching for both objects and indexes. The <strong>Monitor</strong> menu item displays current issues as detected by the <a href="#concepts-monitoring">monitoring system</a>. Any registered SMG <a href="#concepts-plugins">plugins</a> can show up as menu items too.</p>
<p><a name="concepts" /></p>
<h2 id="concepts-overview">Concepts overview</h2>
<p>SMG uses the (excellent) <a href="http://oss.oetiker.ch/rrdtool/">rrdtool</a> tool to store the values it fetches from external services into so called Round Robin Database (RRD) files. Check the tool homepage for more details but in a nutshell RRD files are with fixed (upon creation) size which store series of numbers over different periods using bigger averaging steps the older the data gets. So rrdtool (and in turn - SMG) keeps most recent data (by default - 96h in SMG) into the minimal for SMG run interval (default - every-minute) granularity (which corresponds to maximal resolution) and older data gets averaged over longer period and kept like that (at smaller resolution).</p>
<p><a name="concepts-rrd-objects" /></p>
<h3 id="rrd-objects">RRD objects</h3>
<p>Every graph in SMG corresponds to one or more (check aggregate functions below) RRD objects. These are configured in the yaml config and have a bunch of properties (described in detail in the <a href="#rrd-objects">config section</a> of these docs).</p>
<p>The object id is a string (unique across object ids namespace), should be descriptive and must only contain alpha numeric characters and some symbols like ‘-’, ’_’ and ‘.’.</p>
<p>The dot can be considered somewhat special as SMG can build an automatic index tree by considering the dot as a level separator and grouping objects with common prefixes. So a good object id can look like this: <strong>class.hostname.svcname</strong> (Example: <em>host.a1.sysload</em>). Note that this is only by convention and it is not enforced by SMG, however having good object ids is critical to be able to use it effectively (see Filters below).</p>
<p>Each rrd object also defines one or more variables (<strong>vars</strong>) and the external <strong>command</strong> is expected to output (at least) as many numbers when invoked, one per line. Getting less lines or non-numbers will cause an error (a NaN will be recorded in the RRD). Getting more lines will not trigger an error and SMG will only use the first N (equal to number of variables) lines. This is intentional and is in order to support mrtg helper scripts directly (these normally output hostname and uptime at the end).</p>
<p>Every RRD object also has an <strong>interval</strong> associated with it. That determines how often the command specified in the config will be executed and its output (numbers) recorded in the RRD file. The default interval if not specified in the config is 60 seconds (or every minute).</p>
<p>Check <a href="smg-config.html#rrd-objects">RRD Objects configuration</a> for more details on what properties are supported for given RRD object.</p>
<p>In addition to regular RRD objects (with values for update coming from external command output) SMG supports Aggregate Rrd Objects. These don’t have their own command to run but instead use values fetched for multiple other regular RRD objects to produce a single aggregate value for every variable defined and then update that in a RRD file. These are distinguished from regular RRD objects by prepending a ‘+’ to the object id in the yaml config.</p>
<p>Check <a href="smg-config.html#rrd-agg-objects">Aggregate RRD Objects configuration</a> for more details on what properties are supported for given Aggregate RRD object.</p>
<p><a name="concepts-intervals" /></p>
<h3 id="intervals-runs-and-scheduler">Intervals, runs and scheduler</h3>
<p>SMG has the concept of regular (every <em>interval</em> seconds) <em>runs</em> where it will execute the commands specified in the objects configs. All objects having the same interval config value will be processed during the respective interval run (also see the next section on pre_fetch and run trees). All per-interval runs execute in their own separate thread pool, so that e.g. slow hourly commands do not interfere too much with fast every-minute commands. Aggregate RRD object updates happen after all regular rrd objects have been updated, at the end of the interval run. Thread pools are configurable via the $interval_def global.</p>
<p>By default SMG will use its internal scheduler to trigger the regular runs. Without getting into too much detail here it will trigger (separate) runs for every discovered unique rrd object (or plugin) interval value, whenever the applicable time comes. If desired one can also use an external scheduler like cron. For this to work one needs to set <em>smg.useInternalScheduler</em> in application.conf to <em>false</em> and then schedule the smgscripts/run-job.sh script as cron jobs (per interval, passed as param to run-job.sh) as needed.</p>
<p><a name="concepts-pre_fetch" /></p>
<h3 id="pre_fetch-and-run-command-trees">pre_fetch and run command trees</h3>
<p>One important thing when trying to get and update RRDs for tens of thousands of values from remote servers every minute is to reduce the number of remote connections one has to make to the target (monitored) servers. For example in mrtg, nagios (and if not misatken - in cacti too) every check/graph object configured results in a call to a separate external command getting remote data and/or a SNMP get.</p>
<p>Instead (and ideally) we would use a single command to get all the values we want from a given host and then possibly produce many rrd objects and graphs from these. Note that this is how Prometheus works with its /metrcis calls but that only works over http.</p>
<p>This is where SMG’s pre_fetch simplifies things - it is a special config object defining an id and a command to execute. Then RRD objects can have a pre_fetch attribute specified with a value - the mentioned pre_fetch id.</p>
<p>This allows the pre_fetch command to store its ouput data cached somehere locally on the SMG host and then the actual RRD object commands do not need to go to the target server but can use the cached local data. For example we use a pre_fetch command to get all SNMP values we care about from a given host in a single shot (about sysload, cpu usage, i/o, mem etc). Then we update many RRD objects from the pre-fetched data. Since recently pre_fetch also supports passing the command stdout directly to the child command stdin without the need to use temp files.</p>
<p>In addition pre_fetch itself can specify another pre_fetch command to be its parent. That way one can define a hierarchical command tree structure (“run tree”) where many child commands depend on a single parent command and a set of parents can define a common parent of their own etc. Example use case for this is to define a top-level <em>ping -c 1 ip.addr</em> pre_fetch command for given host and then all other pre_fetches (or actual rrd objects) for that host can have the ping pre_fetch defined as parent and will not run at all if e.g. the host is down (not ping-able). Having such setup will also make SMG only send a single “failed” alert if a host is down (vs alerts for each individual command).</p>
<p>An important note is that SMG will execute child pre-fetch commands in sequence (but not rrd object commands which are always parallelized up to the max concurrency level configured for the interval). The intent is to be able to limit the number of concurrent probes hitting some target host to 1 per interval. This behavior can be overriden by setting the <strong>child_conc</strong> property on the pre-fetch command to more than the default 1 (setting the number of max concurrent threads that can execute child pre-fetches of this pre-fetch).</p>
<p><a name="concepts-period" /></p>
<h3 id="period-since-and-period-length">Period since and period length</h3>
<p>By default SMG will plot graphs for a period starting at some point back in time and ending “now”. The starting point is determined by the <strong>Period Since</strong> UI param (default is 24h). Sometimes one may want to use a different end point in the graphs than “now”. This can be requested using the <strong>Period Len</strong> UI param, specifying how long period the graphs should cover (starting at the point defined with Period Since). Both parameters and their format are described in detail <a href="smg-config.html#period">here</a></p>
<p><a name="concepts-filters" /></p>
<h3 id="filters">Filters</h3>
<p>SMG maintains the list of all objects available for graphing in memory.</p>
<p>Whenever it has to display some set of (different objects) graphs, the selection happens via a filter over the global list. This is how one selects which graphs to see on the page. This is also why object ids are very important, so that you can easily select classes of objects to display together.</p>
<p>Currently one can filter by object id, object “text representation” (title etc), object labels and <a href="#concepts-remotes">remote instance</a>. Below are the currently supported filter fields as present in the UI. These match the <a href="smg-config.html#filters">index filter configuration</a> options and if any filter turns out to be useful it can be converted to a named index and configured in the yaml for quick access. Also any filter result can be shared by just sharing its SMG URL - the filter fields are sent as plain URL params to SMG.</p>
<p><strong>Note:</strong> Using regex filter on object id and title to define groups of objects may look awkward at first sight but is actually quite powerful (and the idea was “borrowed” from <a href="http://oss.oetiker.ch/mrtg/doc/indexmaker.en.html">mrtg indexmaker</a>). By using good object ids to “describe” the SMG objects admins can save themselves the need to explicitly define too many object (grouping/classification) properties upfront, but instead easily use the filters to define arbitrary groups later when needed.</p>
<p><a name="flt-remote" /></p>
<h4 id="remote-filter">Remote filter</h4>
<ul>
<li>a drop down to select a specific <a href="#concepts-remotes">remote instances</a> to search in or to search in all remotes via the special asterisk <em>*</em> remote id. Note that this filter is not visible unless there is at least one configured remote instance.</li>
</ul>
<p><a name="flt-titlerx" /></p>
<h4 id="text-regex-filter">Text Regex filter</h4>
<ul>
<li>when set, only objects where any of object id, title, command, object labels, var labels or measurement units is matched by the specified regular expressions will be matched by the filter.</li>
</ul>
<p><a name="flt-prefix" /></p>
<h4 id="prefix-filter">Prefix filter</h4>
<ul>
<li>when set, only object ids having the specified prefix string (starting with it) will be matched by the filter. Note that this is not a regexp but a direct string comparison (and e.g dots are not special match-all symbols).</li>
</ul>
<p><a name="flt-suffix" /></p>
<h4 id="suffix-filter">Suffix filter</h4>
<ul>
<li>when set, only object ids having the specified suffix string (ending with it) will be matched by the filter. Note that similar to prefix filter this is not a regexp but a direct string comparison.</li>
</ul>
<p><a name="flt-regex" /></p>
<h4 id="regex-filter">Regex filter</h4>
<ul>
<li>when set, only object ids matching the specified regular expressions will be matched by the filter.</li>
</ul>
<p><a name="flt-rxexclude" /></p>
<h4 id="regex-exclude-filter">Regex Exclude filter</h4>
<ul>
<li>when set, only object ids NOT matching the specified regular expressions will be matched by the filter.</li>
</ul>
<p><a name="flt-prx" /></p>
<h4 id="parent-regex-filter">Parent Regex filter</h4>
<ul>
<li>when set, only objects whose parent ids match the specified regular expressions will be matched by the filter.</li>
</ul>
<p><a name="flt-labels" /></p>
<h4 id="labels-filter">Labels filter</h4>
<ul>
<li>when set, only objects whitch match the corresponding object labels expression will be matched by the filter. See the Index Filter section of the configuration reference for the <a href="smg-config.html#filters-lbls">labels filter syntax</a>,</li>
</ul>
<p><a name="flt-index" /></p>
<h4 id="index-filter">Index filter</h4>
<ul>
<li>Where Index (<a href="smg-config.html#indexes">described here</a>) itself defines a filter, the index id is a “first class” filter member too. So when visiting an Index url one sees the index filter separately from the user filter and the user filter works only within the already filtered by the index filter list of objects. The UI provides options to remove the index filter or merge it with the user filter resulting in an “index-free” filter.</li>
</ul>
<p><a name="concepts-indexes" /></p>
<h3 id="indexes">Indexes</h3>
<p>An index is basically a named filter with some additional properties. One can configure indexes in the yaml config and SMG can auto-discover indexes with good object ids structure. Indexes can be structured in a hierarchy where each index can specify a parent index id. The main SMG page currently displays all top-level indexes (ones which don’t have a parent) and also the a configurable number of levels after that (using the <a href="#index-tree-levels">$index-tree-levels</a> global var). Check <a href="smg-config.html#indexes">the index config section</a> for more details on indexes.</p>
<p><a name="concepts-cdash" /></p>
<h3 id="custom-dashboards">Custom dashboards</h3>
<p>The custom dashboard represents a single page which can combine the graphs outputs from multiple indexes. The layout of the page can be defined using sizes in the configuration. In addition it can display monitor states and/or logs plus external items via iframe. Check the <a href="smg-config.html#cdash">$cdash</a> config options for more details.</p>
<p><a name="concepts-gopts" /></p>
<h3 id="graph-options">Graph options</h3>
<p>These generally allow one to set some non-default graph options, when desired. By default SMG will plot the data for the requested period but also plot the previous period of the same length using dotted lines. It will also plot a dashed line at the 95 perecntile value for each plotted variable. Both of these can be disabled using the respective check-box in the filter UI.</p>
<p><a name="concepts-step" /></p>
<h4 id="step">Step</h4>
<p>By default rrdtool will pick the “best” possible step (what period a data point in the graph will correspond to) based on the available in RRAs data and the requested period. Usually that will be the highest available resolution data which would also fit on the graph. E.g. for graphs updated every minute, SMG will display 1 data point per minute (1-min average) on a 24-hours graph. If we want to see the data at 5-minute average values we could set step to 300 (seconds) and get that.</p>
<p><a name="concepts-maxy" /></p>
<h4 id="maxy">MaxY</h4>
<p>Sometimes one would get big “spikes” in the data where for a short period the data points values get orders of magnitude higher than normal. When displaying such a graph one usually sees a huge spike and the values around it look like a flat line, close to 0. So in order to see details around such spikes one can set the <strong>MaxY</strong> (maximum Y) value of the graphs. Such a graph will have a gap where the spike was occurring but the surrounding time series data can be seen in a good detail.</p>
<p><a name="concepts-miny" /></p>
<h4 id="miny">MinY</h4>
<p>Similar to MaxY, MinY determines the minimum Y value which will be displayed on the graphs.</p>
<p><a name="concepts-rows-and-cols" /></p>
<h4 id="rows-and-columns">Rows and columns</h4>
<p>Whenever SMG displays the graphs resulting from the given filter it uses the <strong>Rows</strong> and <strong>Columns</strong> form parameter values to limit the displayed graphs (it is unlikely that we want 10000 graphs displayed on one page). So one would see at most “Columns” columns of graphs in a “row” (may be less, depending on screen size) with at most “Rows” rows per page.</p>
<p><a name="concepts-sorting" /></p>
<h4 id="sorting-and-grouping">Sorting and grouping</h4>
<p>SMG supports sorting a displayed page of graphs by the average value of a given object variable. The object variable is specified via the 1-based integer position of the variable within the list of object ones - the <em>x-sort</em> dashboard filter form field.</p>
<p>For example if you have page of graphs showing network switch ports (objects with two variables - one for incoming and one for outgoing traffic) and if you want to sort them by their outgoing traffic (that would be the second var in the object’s vars list) you would set <em>x-sort</em> = 2. The default <em>x-sort</em> value (0) implies no sorting.</p>
<p>One important note is that sorting is an expensive operation - it involves a <em>rrdtool fetch</em> command in addition to the graph command (<em>rrdtool graph</em>) and the former is almost as expensive as the later. Because of this currently SMG will only sort within the currently displayed page of graphs. This is mainly to avoid cases where (possibly by mistake) one can try to sort all graphs (possibly hundreds of thousands) by setting x-sort to 1 on a match-all filter.</p>
<p>The current workaround to that limitation is to set a high-enough <em>rows</em> parameter so you get all the graphs you want to sort on one page which you can sort after.</p>
<p>A special case of sorting is group by (with value of x-sort=-1, or the GroupBy button). In this case graphs will be grouped for display based on the Group By drop down value.</p>
<p>The different options in the drop down match the Index “group by” (gb) config values and are described in detail in the respective <a href="smg-config.html#group-by">configuration reference section</a>.</p>
<p><a name="concepts-aggregate-functions" /></p>
<h3 id="aggregate-functions">Aggregate functions</h3>
<p>SMG supports “aggregating” graphs for objects which have compatible set of time series and grouped based on the Group By drop down value mentioned above. This works using one of the currently available functions (these are available as buttons on the graphs display page):</p>
<ul>
<li><strong>GROUP</strong> - just putting the same type graphs together in a single graph</li>
<li><strong>STACK</strong> - stacking the graph lines on top of each other</li>
<li><strong>SUM</strong> - summing the same-type lines form the multiple objects together</li>
<li><strong>SUMN</strong> - same as SUM except that NaN values are treated as 0. This is mostly useful when you want to see some historical data for a sum of graphs but where some of these were created later. With SUM one would see gaps where one of the component has NaN value for the time point where SUMN will happily conver the NaNs to 0 and still display a line.</li>
<li><strong>AVG</strong> - similar to SUM but displaying graphs for the average value of the same-typed lines.</li>
<li><strong>MAX</strong> - similar to SUM but displaying graphs for the max value across the same-typed lines.</li>
<li><strong>MIN</strong> - similar to SUM but displaying graphs for the min value across the same-typed lines.</li>
</ul>
<p>By default (and when the filter results in objects from multiple remotes) SMG will do the aggregation “by remote”, i.e will produce separate aggregate images for given set of identical var-definition objects - one per remote instance. One can request a <strong>Cross-remote</strong> aggregation by selecting the respective check-box, before clicking on the aggregate function button. This works by downloading the remote rrd files locally and then producing an image from them so it is expected to be somewhat slower.</p>
<p><a name="concepts-view-objects" /></p>
<h3 id="view-objects-and-calculated-graphs">View objects and calculated graphs</h3>
<p>In addition to the mentioned RRD objects, SMG also supports <em>View objects</em>. These are defined on top of RRD objects - every View object must reference a RRD Object. Technically SMG cares only about RRD (update) objects when doing the interval runs for updates but only cares about View objects when filtering for display.</p>
<p>By default every RRD Object is also a View object so one does not need to explicitly define View objects except in some cases described below.</p>
<p>View objects are useful to display a subset of an existing RRD object vars (lines) and/or re-order them via the <a href="smg-config.html#gv">gv (“graph vars”)</a> config value.</p>
<p>The other use case of View objects is that these support special <em>cdef variables</em>. rrdtool supports complex arithmetic expressions (using the available variables) to calculate plotted values. More details <a href="http://oss.oetiker.ch/rrdtool/tut/cdeftutorial.en.html">here</a>.</p>
<p>One example use case for this is varnish stats - varnishstat reports separate “requests” and “cache hit” (simple) counters. Normally one defines these as COUNTERs in rrdtool and gets an “average rate” (number/sec) when plotting/fetching csv. So we can define a special cdef variable in SMG which divides the “cache hit” rate (x 100) by the total “requests” and we effectively get an average “cache hit percentage” for the given period.</p>
<p>Check the <a href="smg-config.html#cdef_vars">Cdef variables</a> section for more details.</p>
<p><a name="concepts-remotes" /></p>
<h3 id="remotes">Remotes</h3>
<p>SMG was designed with multiple data centers (a.k.a. “<em>remotes</em>”) in mind from the start (this was actually one of the drivers for us to create SMG).</p>
<p>We run multiple Data Centers (DCs) at Smule. Normally one does not want to run cross-dc monitoring probes (often simply because its too slow). Also one can not expect a single monitoring instance (whether SMG, mrtg or cacti) to be able to keep up with a huge number of every-minute updates, whether across multiple data centers or within the same DC. So having one humongous monitoring instance does not work and normally people using mrtg or cacti would split the graphs across multiple instances to reduce the number of graphs each individual instance needs to keep up with. The draw-back is that one has to go to different host/url to get the relevant graphs and there is no single “namespace” where one can view graphs from multiple instance in the same UI.</p>
<p>This is where SMG <em>remotes</em> come into play. Similar to mrtg and cacti we would split the stuff we want graphed into multiple instances. Each of these instances will maintain and update its own subset of the rrd objects.</p>
<p>However in SMG one can define <em>remote</em> instances (host:port) where it is able to get the configured (RRD+View) objects in the remote instance and “merge” these into the local objects list. All remote ids are prefixed with <em>@&lt;remoteid&gt;.</em> when merged into the local object ids namespace to avoid name conflicts (the ‘@’ symbol is otherwise forbidden in object ids).</p>
<p>Then <a href="#concepts-filters">filters</a> can specify filtering within one or more specific remotes or can specify the special ’*’ (wildcard) remote id to match objects across all remotes.</p>
<p>Internally this works over remote (json-response) http APIs which expose all needed graphing and config/data retrieval operations.</p>
<p>Note that if some remote SMG node dies its graphs/data will become unavailable (i.e. at this point there is no “high availability”), it is mostly a convenience to get all monitoring in a single UI “dashboard”.</p>
<p><a name="concepts-plugins" /></p>
<h3 id="plugins">Plugins</h3>
<p>SMG supports plugins (configured in application.conf) which are just Scala classes implementing a specific interface (trait in Scala terms).</p>
<p>At a high level plugins can do a bunch of things:</p>
<ul>
<li><p>each plugin has an <em>interval</em> associated with it. Its run() method will be executed by the scheduler as needed, every <em>interval</em> seconds.</p></li>
<li><p>plugins can provide custom RRD objects implementations. For example some data may be available for graphing later - e.g. logs rotated hourly where every hour we want to graph the previous hour (now rotated) data, e.g. per minute. This does not fit in the usual SMG model of run-this-command-every-X-minutes-to-get-data-points and we have plugin(s) which can do this kind of stuff. Also, there may be some cases where you don’t even know all the objects you want to graph upfront (so that you could configure them). A custom SMG plugin can dynamically discover objects as they appear.</p></li>
<li><p>provide custom indexes - similar to custom objects, plugin can provide relevant indexes too (normally - grouping the custom plugin objects in some way which makes sense)</p></li>
<li><p>plugin can also provide arbitrary display of some relevant data (e.g. <strong>calc</strong> plugin) and also provide “object actions” to provide display of data specific to an object (e.g. the <strong>jsgraph</strong> plugin providing “Zoom” and “Historam” actions)</p></li>
<li><p>Plugin can implement monitor checks (via valueChecks method) to extend the available by default alert-[warn|crit]-[gt[e]|lt[e]|eq] options. E.g. one can check for value anomalies etc. See the mon plugin for example.</p></li>
<li><p>Plugins can implement custom dashboard items - TODO</p></li>
<li><p>Plugins can implement “internal commands” for various reasons including e.g. keeping persistent JMX connections between runs or more efficient parsing of things like OpenMetrics (Prometheus) and CSV stats,</p></li>
</ul>
<h4 id="currently-available-plugins">Currently available plugins</h4>
<ul>
<li><p>jsgraph - this plugin provides a JavaScript graphing capabilities for objects exports two actions (“Zoom” and “Histogram”). It works by using the existing API to fetch raw csv data from the rrd object(s) and using the <a href="http://plot.ly/">plot.ly</a> library to display fancier graphs client-side.</p></li>
<li><p>calc - this plugin provides ability to plot arbitrary graph from SMG object time-series by applying complex arithmetic expressions involving these time-series.</p></li>
<li><p>jmx - one can fetch JMX values using bash command wrappers which might work for longer update intervals and not too many objects but is problematic as establishing the JMX connection can be slow (and thus - expensive). It would be much better to to use persistent connections and this is what the SMG JMX plugins provides. Documentation TBD</p></li>
<li><p>mon - the “mon” (SMGMonCheckPlugin) plugin currently implements two types of value checks - anomaly detection and period-over-period check. Plugin checks are configured using the special alert-p-<em>pluginId</em>-<em>checkId</em>: “<em>conf</em>” config attribute.</p></li>
<li><p>rrdchk - being able to check and fix rrd files for cinsistency with configuration</p></li>
<li><p>scrape - a “Prometheus replacement” plugin which can generate SMG objects/configs from “scrape targets” wich are http end-points exposing metrics in specifc (OpenMetrics) format, usually at /metrics URL. Note that SMG itself exposes such /metrics end-point and the scrape plugin is enabled to process localhost:9000/metrcis by default. TODO - config reference doc. The “Prometheus replacement” part is now deprecated in favor of autoconf which can do the same using the openmetrics template.</p></li>
<li><p>autoconf - this is very similar to the scrape plugin but can support arbitrary protocols via special “templates” - essentially specifying the “type: of service being monitored. That allows monitoring using the native service protocols and nit needing prometheus”exporters". TODO - config reference doc.</p></li>
<li><p>kube - a (work-in-progress) Kubernetes monitoring plugin. It is able to auto-discover K8s nodes, end-points, services etc and metrics from that (in similar way Prometheus does that). The in-cluster services can be annotated for monitoring and these annotations are compatible with Prometheus. It can also use autoconf templates in addition to Prometheus/OpenMetrics end-points.TODO - config reference doc</p></li>
<li><p>influxdb - plugin to forward all data writes to an influxdb end-point (in batches) in format compatible with the Prometheus influxdb adapter.</p></li>
<li><p>cc - (CommonCommands) implements various commands including parsers+getters for CSV output, SNMP (snmpget) output, string transformers as more efficient replacements for using bash/cut/awk etc as external commands.</p></li>
</ul>
<p><a name="concepts-monitoring" /></p>
<h3 id="monitoring">Monitoring</h3>
<p>SMG main function is to fetch many values from various services and keep RRD databases updated using that information. Also in traditional setups one might run mrtg or cacti (or SMG) for graphing and nagios for alerting. This implies that a lot of values are fetched twice - once for nagios and once for graphing. So it makes sense to be able to define alerts based on the wealth of values SMG fetches and avoid the double-hit on the target servers.</p>
<p>The original idea for SMG monitoring was to be implemented as plugins fetching the data from the rrd files and determining whether values are within thresholds. This also allows one to check data at arbitrary (as available in the RRD files) resolution for desired periods. Unfortunately there is one significant issue with that approach - it is too heavy to apply on all objects (based on experience it can almost half the number of objects SMG is capable to update every minute on given hardware).</p>
<p>This is not acceptable so now (as of v0.2) SMG has built-in monitoring based on a “live” (in memory) data feed consisting of all the values fetched for RRD updates. One can define alerts (acceptable values/ranges) in SMG as part of the object variables configurations or as part of indexes (including “hidden” indexes which sole current purpose is to define alerts).</p>
<p>The <a href="/monitor">monitoring page</a> page displays all (local or remote) current problems (anything with non-OK state). SMG supports the following states, sorted by severity:</p>
<ul>
<li><p><strong>OK</strong> - The normal state - a valid value was retrieved and updated in the RRD.</p></li>
<li><p><strong>ANOMALY</strong> - Currently there are two types of anomalies, the first is a “counter overflow”, e.g. a 32 bit counter passes 2^32 (or was reset) resulting in NaN value and the second one is a “spike” or “drop” - read the notes below for more details on <a href="#concepts-anomaly">anomaly detection</a>.</p></li>
<li><p><strong>WARNING</strong> - A retrieved value matched against some defined “warning” threshold.</p></li>
<li><p><strong>FAILED</strong> - A data retrieval failed - the external command (pre-)fetching data failed. This can happen for various reasons including target host or service down.</p></li>
<li><p><strong>CRITICAL</strong> - A fetched value matched against some defined “critical” threshold.</p></li>
<li><p><strong>SMGERR</strong> - global SMG error. Usually - overlapping runs (or SMG bug).</p></li>
</ul>
<p>Check <a href="smg-config.html#monitoring">monitoring configuration</a> for more details on how the thresholds are defined in the yaml configuration.</p>
<p>These states come in two flavors - “<strong>HARD</strong>” (at least consecutive 3 non-ok states) and “<strong>SOFT</strong>” (less than 3 consecutive non-ok states). The OK state is always HARD. These concepts are borrowed from nagios.</p>
<p>On shut-down all the in-memory state for monitoring is saved to json files (in the directory specified by the <strong>$monstate_dir</strong> global config value) and loaded on start-up.</p>
<p>SMG also supports “silencing” alerts which is basically hiding them from the error page and preventing alert notifications. There are two types of silencing:</p>
<ul>
<li><p><strong>Acknowledge</strong> - this will “silence” a current error until it gets back into a normal state which will automatically clear the acknowledgement.</p></li>
<li><p><strong>Silence for</strong> - silence some error for given time period after which the silencing will expire. Silencing does not clear on recovery which is different than acknowledgement and is useful when one wants to prevent alerts upfront when some host or service has planned maintenance and downtime and also for services which are in “flapping” state - flipping between OK and non-OK states (otherwise acknowlegement is better).</p></li>
<li><p><strong>Sticky silencing</strong> - this allows one to define regex (and regex exlude) filters which will silence all matching objects but also matching ones defined in the future (until the silencing period expires). This function is available as a check-box in the Monitor - State trees page described below.</p></li>
</ul>
<p>By default SMG will not show Soft, Acknowledged or Silenced errors in the Monitor page - this can be toggled for each type using the respective checkboxes.</p>
<p>In addition to current error states SMG keeps track of recent error events on the Monitor - <a href="/monitor/log">Event log</a> page. Internally these are stored in log files under the directory speciified by the <strong>$monlog_dir</strong> global config value.</p>
<p>One can browse the current SMG state trees (built based on the Run trees mentioned above) in the Monitor - <a href="/monitor/trees">State trees</a> page. This page allows easy upfront silencing of mutltiple hosts/services when these have maintenance/downtime pending. This is also where the Sticky silencing check-box is available.</p>
<p>All currently silenced states and also currently active Sticky silences can be seen in the Monitor - <a href="/monitor/silenced">Silenced states</a> page. This page useful to explicitly un-silence objects and remove active Sticky silences before the silencing period has expired.</p>
<p>Ths Monitor - <a href="/monitor/runtree">Run trees</a> page display the entire internal SMG Run trees (per-interval) structure. Useful to troubleshoot config issues and sanity checking what SMG does on every interval run.</p>
<p>There is also a <a href="/monitor/heatmap">heatmaps page</a> available where one can see a graphical representation of the overal systems health (work in progress and subject to change).</p>
<p><a name="concepts-anomaly"></p>
<h4 id="anomaly-detection-via-the-mon-check-plugin">Anomaly detection (via the “mon” check plugin)</h4>
<p>The SMG Mon check plugin anomaly detection works based on a “threshold for difference” (default = 1.5) and two time periods - shorter (default 30 minutes) and longer (default - 30 hours). Will use the default values in the examples below.</p>
<p>First, for any value which has a “spike check” configuration (“alert-p-mon-anom”) enabled SMG will start keeping in-memory stats about the most recent values. The number of stats that will be kept depends on the object interval compared to the configured check periods - e.g. for a graph updated every minute, 30 minutes would map to 30 data points and 30h to - 1800. SMG keeps the short period values (30 in the example) at full granularity. For the long period data instead of keeping all individual 1800 values SMG will group them in overlapping chunks each with the size of the short period or each chunk will cover 30 minutes. How that works is that internally SMG keeps up to half-short period (30 / 2 = 15) values more at full granularity (in addition to the 30 short-term ones) named “previous short term” values. Whenever that list size increases to half the short-period, its values are combined with the first half of the short-period values (for a full short-period sized chunk) and SMG will add an aggregate value to the “long term” stats list before truncating the “previous short term” list to empty (and also throwing away a long term stat if above max size). The actual aggregation consist of calculating the following stats for the chunk:</p>
<ul>
<li>average - the average value - sum(values) / count(values)</li>
<li><a href="http://www.mathsisfun.com/data/standard-deviation.html">variance</a> - this is a “population variance”</li>
<li>90 percentile value - the max value after throwing away the top 10% values</li>
<li>count - how many data points were used to calculate the above stats (useful to know when the threshold/periods change).</li>
</ul>
<p>So in our example SMG would keep between 30 and 45 data points at max granularity and an up to 120 data points for the long period.</p>
<p>The second part is the actual check logic. This is still somewhat work in progress but at a high level the logic is based on chunks stats “similarity”. So when checking for alert SMG will calculate the same chunk stats from the short-term stats and the previous short-term stats. Then it will compare the calculated short-term chunk stats with all of the long term period stats. If any of the short-term stats average, varinace or 90%-ile values are within 1.5 (the mentioned “difference” threshold) times difference (more or less) from the compared long term stat then the two stats are “similar” and SMG will rule out the possibility that there is an anomaly (it has “seen” similar values already).</p>
<p>There are some additional checks to see whether it is a spike or drop but overall the approach is to focus on finding patterns proving that the current state is NOT an anomaly.</p>
<p><a name="running"></p>
<h2 id="running-and-troubleshooting">Running and troubleshooting</h2>
<p><a name="docker-mode" /></p>
<h3 id="run-in-a-container">Run in a container</h3>
<ul>
<li><p>mkdir -p /opt/smg/data /etc/smg/conf.d</p></li>
<li><p>docker run -d –name smg -p 9000:9000 -v /opt/smg/data -v /etc/smg/conf.d/ gcr.io/asen-smg/smulegrapher:latest</p></li>
<li><p>Point your browser to http://$DOCKER_HOST:9000 (the local metrics stats should show up in a minute or two)</p></li>
<li><p>Then add stuff under /etc/smg/conf.d (and/or /opt/smg/data/conf/autoconf.d) and to reload conig use one of:</p>
<ul>
<li>docker exec smg /opt/smg/inst/smg/smgscripts/reload-conf.sh</li>
<li>curl -X POST http://$DOCKER_HOST:9000/reload</li>
</ul></li>
</ul>
<p><a name="k8s-mode" /></p>
<h3 id="run-in-k8s">Run in k8s</h3>
<p>Check the k8s/ dir for example deployment yamls, including in-cluster monitoring with auto-discovery (similar to Prometheus)</p>
<p><a name="classic-mode" /></p>
<h3 id="classic-mode">Classic mode</h3>
<p><a name="pre-reqs" /></p>
<h4 id="pre-requisites">Pre-requisites</h4>
<p>SMG needs the following software to run.</p>
<ul>
<li>SMG needs <strong>bash</strong> and <strong>gnu timeout</strong> to work out of the box. Bash is available on pretty much any unix installation and gnu timeout may have to be installed (on e.g. Mac). It should be possible to run under Windows using cygwin but never tried.</li>
</ul>
<blockquote>
<p>Note: The “bash” and “timeout” commands are actually configurable in application.conf and can be replaced with other commands with similar functionality. E.g. in theory it should be possible to replace bash with cmd.exe.</p>
</blockquote>
<ul>
<li><p><strong>rrdtool</strong> - <a href="http://oss.oetiker.ch/rrdtool/index.en.html">rrdtool</a> is available as a package on most linux distributions. It comes with <strong>rrdcached</strong> - a “caching” daemon which can be used for more efficient updates (rrdtool will not write directly to files but will send updates to rrdcached for batch updates). Although using rrdcached is optional (check the <a href="#rrd_socket">$rrd_socket global config option</a>) it is highly recommended if you plan to do tens of thousands of updates every minute.</p></li>
<li><p><strong>Java 11+</strong> - SMG is written in Scala and needs a JVM (Java 11+) to run. One must set the <strong>JAVA_HOME</strong> environment variable pointed to that before launching SMG.</p></li>
<li><p><strong>httpd</strong> (optional) - SMG comes with its own embedded http server however since images are served as files from the filesystem it is more efficient to use a native http server to serve these (e.g. Apache or Nginx). For this to work one would setup the http server as a reverse proxy to the SMG instance but bypassing SMG when serving images. Here is an example apache conf file to enable httpd listening on port 9080 (in this case SMG is told to output its images in the /var/www/html/smgimages dir via the <a href="#img_dir">$img_dir config option</a>):</p></li>
</ul>
<pre>
    Listen 9080
    &lt;VirtualHost *:9080>
        ProxyPass  /assets/smg !
        ProxyPass        /  http://localhost:9000/
        ProxyPassReverse /  http://localhost:9000/
        Alias /assets/smg /var/www/html/smgimages
    &lt;/VirtualHost>
</pre>
<p><a name="install-tgz" /></p>
<h4 id="installation-from-.tgz-bundle">Installation from .tgz bundle</h4>
<p>SMG comes as a pre-built tgz archive named like <em>smg-$VERSION.tgz</em> (e.g. smg-0.3.tgz). You can unpack that anywhere which will be the SMG installation dir. Here are example commands to unpack SMG in /opt/smg:</p>
<pre>
# cd /opt
# wget https://github.com/asen/smg/releases/download/v1.3/smg-1.3.tgz
# tar -xf smg-*.tgz
# mv smg-* smg # (or ln -s smg-* smg)
</pre>
<p>SMG comes with start and stop and scripts which in the above example would be available as:</p>
<ul>
<li><p><strong>/opt/smg/start-smg.sh</strong> - use this to start SMG as a daemon process. It requires JAVA_HOME to be pointed to a supported Java installation.</p></li>
<li><p><strong>/opt/smg/stop-smg.sh</strong> - use this to gracefully stop the running as a daemon SMG process.</p></li>
</ul>
<p>Before you start SMG you need to create a basic <strong>/etc/smg/config.yml</strong> file and likely define at least a few RRD objects. One can use the smgconf/config.yml file inside the installation dir as example and should check the <a href="smg-config.html#config">configuration reference</a> for more details. Note that SMG will happily start with empty objects list (not that this is much useful beyond the ability to access this documentation when setting up).</p>
<p>Once you start SMG you can access it by pointing your browser at port 9000 (this is the default listen port). If using the httpd.conf example above, that would be port 9080.</p>
<p>Of course one would likely to define many objects before using SMG for real. Check the <a href="#config">configuration reference</a> for more details. We at Smule use chef to manage our servers and also to genereate most of our SMG configuration (based on hosts/services templates). Describing this in detail is beyond the scope of this documentation - use your imagination.</p>
<p>One important note is that whenever you update the yaml config file you need to tell the running SMG to reload its cofniguration (without actually restarting SMG). This is done via a http POST request like this:</p>
<pre>
    curl -X POST http://localhost:9000/reload
</pre>
<p>Or use the bundled with SMG bash wrapper around that command available as <strong>smgscripts/reload-conf.sh</strong> (relative to the install dir)</p>
<p>In addition, SMG is highly tunable via its Play framework’s application.conf. Check the <a href="#running">Running and troubleshooting</a> section for more details.</p>
<p><a name="install-src" /></p>
<h4 id="installation-from-sources">Installation from sources</h4>
<ul>
<li>This is mostly meant for development purposes.</li>
</ul>
<h4 id="reverse-proxy">Reverse proxy</h4>
<ul>
<li>see the k8s/ deployment with nginx in front of the Play app</li>
<li>example apache Reverse proxy conf</li>
</ul>
<pre>
        Listen 9080

        &lt;VirtualHost *:9080>
            # optional config to intercept /proxy/ requests to the respective remotes
            # and not have the SMG JVM do the proxying
            ProxyPass        /proxy/some-dc/  http://smg1.some-dc.myorg.com:9080/
            ProxyPassReverse /proxy/some-dc/  http://smg1.some-dc.myorg.com:9080/
            ProxyPass        /proxy/other-dc/ http://smg2.other-dc.myorg.com:9080/
            ProxyPassReverse /proxy/other-dc/ http://smg2.other-dc.myorg.com:9080/

            # do not proxy static files/images but serve them directly
            # from the configured SMG $img_dir
            ProxyPass  /assets/smg !
            Alias /assets/smg /opt/smg/public/smg

            # the actual proxy to SMG
            ProxyPass        /  http://localhost:9000/
            ProxyPassReverse /  http://localhost:9000/
        &lt;/VirtualHost>
</pre>
<ul>
<li><p>application.conf</p></li>
<li><p>logs</p></li>
</ul>
<p><a name="dev-setup"></p>
<h2 id="developer-documentation">Developer documentation</h2>
<p>Use the source …</p>
<h3 id="development-setup">Development setup</h3>
<ul>
<li><p>Install JDK 11+&lt;</p></li>
<li><p>Install rrdtool and coreutils (for gnu timeout command). E.g. with homebrew on Mac:</p>
<p>$ brew install rrdtool coreutils</p></li>
<li><p>(Only applicable on Mac) SMG currently needs to use gnu timeout where the default timeout command on Mac is different. There are two ways to address this (after installing coreutiles and gtimeout)</p>
<ul>
<li>change application.conf:</li>
</ul>
<pre>
  # Use smg.timeoutCommand to override the timeout command executable (e.g. gtimeout on mac with homebrew)
  smg.timeoutCommand = "gtimeout"
  </pre>
<ul>
<li>Link /usr/local/bin/timeout to /usr/local/bin/gtimeout on your Mac (that assumes that /usr/local/bin is before /usr/bin in your $PATH</li>
</ul>
<pre>
  ln -s /usr/local/bin/gtimeout /usr/local/bin/timeout
  </pre>
<p>&lt;</p></li>
<li><p>Run:</p></li>
</ul>
<pre>
    $ cd smg
    $ JAVA_HOME=$(/usr/libexec/java_home -v 11) ./run-dev.sh
</pre>
</body>
</html>
